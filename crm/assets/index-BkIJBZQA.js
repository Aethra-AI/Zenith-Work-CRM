import{g as A,c as T,s as q,_ as y,r as c,u as P,d as k,j as e,e as B,f as I,P as R,S as C,h as W,F as E,i as L,k as M,l as F,B as f,M as G,b as _,a as N,T as i,I as U,m as z,C as H}from"./index-DwgVNSjU.js";import{a as v}from"./api-iZ8k4Gbm.js";import{C as w}from"./Chip-D8aj79A0.js";import{F as K,C as O}from"./FormControlLabel-tAHDAUQc.js";import{C as V,a as D}from"./CardContent-BBDjhiT_.js";import{G as S}from"./Grid-5J2R9a1N.js";function $(s){return A("MuiCardActions",s)}T("MuiCardActions",["root","spacing"]);const J=["disableSpacing","className"],Q=s=>{const{classes:a,disableSpacing:n}=s;return I({root:["root",!n&&"spacing"]},$,a)},X=q("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(s,a)=>{const{ownerState:n}=s;return[a.root,!n.disableSpacing&&a.spacing]}})(({ownerState:s})=>y({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Y=c.forwardRef(function(a,n){const r=P({props:a,name:"MuiCardActions"}),{disableSpacing:l=!1,className:h}=r,g=k(r,J),d=y({},r,{disableSpacing:l}),x=Q(d);return e.jsx(X,y({className:B(x.root,h),ownerState:d,ref:n},g))}),Z=({filters:s,setFilters:a,onSearch:n,availableTags:r,loading:l})=>{const h=t=>{a(o=>({...o,q:t.target.value}))},g=t=>{const o=t.target.value;a(p=>({...p,tags:typeof o=="string"?o.split(","):o}))},d=t=>{a(o=>({...o,registered_today:t.target.checked}))},x=t=>{t.key==="Enter"&&n()};return e.jsx(R,{elevation:3,sx:{p:2,mb:3},children:e.jsxs(C,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",children:[e.jsx(W,{fullWidth:!0,label:"Buscar por nombre, empresa, etc.",variant:"outlined",value:s.q,onChange:h,onKeyPress:x,sx:{flexGrow:2}}),e.jsxs(E,{fullWidth:!0,sx:{flexGrow:1},children:[e.jsx(L,{children:"Tags"}),e.jsx(M,{multiple:!0,value:s.tags,onChange:g,input:e.jsx(F,{label:"Tags"}),renderValue:t=>e.jsx(f,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(o=>{var j;const p=((j=r.find(b=>b.id_tag.toString()===o))==null?void 0:j.nombre_tag)||o;return e.jsx(w,{label:p},o)})}),children:r.map(t=>e.jsx(G,{value:t.id_tag.toString(),children:t.nombre_tag},t.id_tag))})]}),e.jsx(K,{control:e.jsx(O,{checked:s.registered_today,onChange:d}),label:"Registrados Hoy"}),e.jsx(_,{variant:"contained",onClick:n,disabled:l,sx:{minWidth:120,height:56},children:l?"Buscando...":"Buscar"})]})})},ee=({candidate:s})=>{const a=s.tags?s.tags.split(",").map(r=>r.trim()):[],n=`/CRM/candidates/profile/${s.id_afiliado}`;return e.jsxs(V,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(D,{sx:{flexGrow:1},children:[e.jsxs(C,{direction:"row",spacing:2,alignItems:"center",mb:2,children:[e.jsx(N,{sx:{width:56,height:56,bgcolor:"primary.light"},children:s.nombre_completo.charAt(0)}),e.jsxs(f,{children:[e.jsx(i,{variant:"h6",component:"div",noWrap:!0,children:s.nombre_completo}),e.jsx(i,{sx:{mb:1.5},color:"text.secondary",children:s.ciudad||"Ciudad no especificada"})]})]}),e.jsxs(C,{direction:"row",alignItems:"center",spacing:1,color:"text.secondary",mb:2,children:[e.jsx(U,{icon:"ph:phone-fill"}),e.jsx(i,{variant:"body2",children:s.telefono})]}),e.jsxs(f,{children:[e.jsx(i,{variant:"subtitle2",gutterBottom:!0,children:"Tags:"}),e.jsx(C,{direction:"row",useFlexGap:!0,flexWrap:"wrap",spacing:1,children:a.length>0?a.map((r,l)=>e.jsx(w,{label:r,size:"small"},l)):e.jsx(i,{variant:"caption",color:"text.secondary",children:"Sin tags asignados"})})]})]}),e.jsx(Y,{children:e.jsx(_,{size:"small",variant:"contained",fullWidth:!0,component:z,to:n,children:"Ver Perfil"})})]})},ie=()=>{const[s,a]=c.useState({q:"",tags:[],registered_today:!1}),[n,r]=c.useState([]),[l,h]=c.useState([]),[g,d]=c.useState(!1),[x,t]=c.useState(null),[o,p]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const u=await v.get("/tags");h(u.data)}catch(u){console.error("Error al cargar los tags:",u),t("No se pudieron cargar los filtros de tags.")}})()},[]);const j=async()=>{d(!0),t(null),p(!0);const m={q:s.q,tags:s.tags.join(","),registered_today:s.registered_today};try{const u=await v.get("/candidates/search",{params:m});r(u.data)}catch(u){console.error("Error en la búsqueda de candidatos:",u),t("Ocurrió un error al realizar la búsqueda. Por favor, inténtelo de nuevo."),r([])}finally{d(!1)}},b=()=>g?e.jsx(f,{display:"flex",justifyContent:"center",mt:5,children:e.jsx(H,{size:50})}):x?e.jsx(i,{color:"error",textAlign:"center",mt:5,children:x}):o?n.length===0?e.jsx(i,{textAlign:"center",mt:5,children:"No se encontraron candidatos que coincidan con su búsqueda."}):e.jsx(S,{container:!0,spacing:3,children:n.map(m=>e.jsx(S,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(ee,{candidate:m})},m.id_afiliado))}):e.jsx(i,{textAlign:"center",mt:5,children:"Utilice los filtros para comenzar una búsqueda de candidatos."});return e.jsxs(f,{p:3.5,children:[e.jsx(i,{variant:"h4",gutterBottom:!0,children:"Búsqueda de Candidatos"}),e.jsx(Z,{filters:s,setFilters:a,onSearch:j,availableTags:l,loading:g}),b()]})};export{ie as default};
